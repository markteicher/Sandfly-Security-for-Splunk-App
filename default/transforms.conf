# -------------------------------------------------------------------------
# transforms.conf
#
# Sandfly Security for Splunk App
#
# Purpose:
# - Define explicit, minimal, AppInspect-safe transforms
# - Support routing, sourcetype hygiene, and optional normalization
# - NO destructive rewriting of _raw
# - NO field dropping
# - NO mutation of Sandfly payloads
#
# Design rules:
# - Sandfly data remains authoritative
# - JSON structure is preserved
# - Transforms are only used where Splunk REQUIRES them
# - All logic is deterministic and auditable
# -------------------------------------------------------------------------

###############################################################################
# Sourcetype enforcement (defensive)
#
# These transforms exist ONLY to guarantee correct sourcetype assignment
# in cases where modular input metadata is missing or malformed.
#
# They DO NOT alter event content.
###############################################################################

[set_sourcetype_sandfly_alarms]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:alarms

[set_sourcetype_sandfly_hosts]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:hosts

[set_sourcetype_sandfly_results]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:results

[set_sourcetype_sandfly_results_timeline]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:results:timeline

[set_sourcetype_sandfly_resultprofiles]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:resultprofiles

[set_sourcetype_sandfly_sandflies]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:sandflies

[set_sourcetype_sandfly_schedules]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:schedules

[set_sourcetype_sandfly_notifications]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:notifications

[set_sourcetype_sandfly_savedviews]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:savedviews

[set_sourcetype_sandfly_reports]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:reports

###############################################################################
# SSH Hunter sourcetypes
###############################################################################

[set_sourcetype_sandfly_sshhunter_summary]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:sshhunter:summary

[set_sourcetype_sandfly_sshhunter_minisummary]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:sshhunter:minisummary

[set_sourcetype_sandfly_sshhunter_keys]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:sshhunter:keys

[set_sourcetype_sandfly_sshhunter_users]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:sshhunter:users

[set_sourcetype_sandfly_sshhunter_hosts]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:sshhunter:hosts

###############################################################################
# Host detail collectors (inventory fan-out)
###############################################################################

[set_sourcetype_sandfly_hosts_kernelmodules]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:hosts:kernelmodules

[set_sourcetype_sandfly_hosts_services]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:hosts:services

[set_sourcetype_sandfly_hosts_processes]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:hosts:processes

[set_sourcetype_sandfly_hosts_users]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:hosts:users

[set_sourcetype_sandfly_hosts_listeners]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:hosts:listeners

[set_sourcetype_sandfly_hosts_scheduledtasks]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:hosts:scheduledtasks

[set_sourcetype_sandfly_hosts_lastlog]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:hosts:lastlog

[set_sourcetype_sandfly_hosts_loggedinusers]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:hosts:loggedinusers

###############################################################################
# Identity / Credential / Auth objects
###############################################################################

[set_sourcetype_sandfly_users]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:users

[set_sourcetype_sandfly_credentials]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:credentials

###############################################################################
# System / Audit / Logging
###############################################################################

[set_sourcetype_sandfly_audit]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:audit

[set_sourcetype_sandfly_logs_audit]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:logs:audit

[set_sourcetype_sandfly_logs_error]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:logs:error

[set_sourcetype_sandfly_config]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:config

[set_sourcetype_sandfly_version]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:version

[set_sourcetype_sandfly_license]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::sandfly:license

###############################################################################
# Index routing (optional / controlled)
#
# These transforms are ONLY enabled if explicitly referenced
# from props.conf.
###############################################################################

[route_to_sandfly_index]
DEST_KEY = _MetaData:Index
REGEX = .
FORMAT = sandfly

###############################################################################
# END OF FILE
###############################################################################
