<!--
=============================================================================
 default/data/ui/views/sandfly_whitelists.xml
 Sandfly Security for Splunk App
 ğŸ§¾ Whitelist Rules
=============================================================================
-->

<dashboard version="1.1" theme="light">
  <label>ğŸ§¾ Whitelists</label>

  <!-- =============================================================== -->
  <!-- ROW 1: SUMMARY METRICS                                          -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>ğŸ“‹ Total Whitelist Rules</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:whitelistrules
            | stats count as total_rules
          </query>
        </search>
        <option name="useColors">true</option>
        <option name="colorMode">block</option>
      </single>
    </panel>

    <panel>
      <title>âœ… Active Rules</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:whitelistrules
            | search active=true
            | stats count as active_rules
          </query>
        </search>
        <option name="useColors">true</option>
        <option name="colorMode">block</option>
      </single>
    </panel>

    <panel>
      <title>ğŸŒ Rules Covering All Hosts</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:whitelistrules
            | search all_hosts=true
            | stats count as all_hosts_rules
          </query>
        </search>
        <option name="useColors">true</option>
        <option name="colorMode">block</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ–¥ï¸ Total Hosts Covered</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:whitelistrules
            | stats sum(hosts_covered) as hosts_covered_total
          </query>
        </search>
        <option name="useColors">true</option>
        <option name="colorMode">block</option>
      </single>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 2: RULE INVENTORY                                           -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>ğŸ“‘ Whitelist Rule Inventory</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:whitelistrules
            | eval host_scope=if(all_hosts=true, "ğŸŒ ALL_HOSTS",
                if(isnotnull(host_tags) AND mvcount(host_tags)&gt;0, "ğŸ·ï¸ HOST_TAGS",
                if(isnotnull(host_ids) AND mvcount(host_ids)&gt;0, "ğŸ†” HOST_IDS", "â“ UNSPECIFIED")))
            | eval host_tags_list=if(isnull(host_tags), "", mvjoin(host_tags, ", "))
            | eval host_ids_list=if(isnull(host_ids), "", mvjoin(host_ids, ", "))
            | eval rules_list=if(isnull(rules), "", mvjoin(rules, " | "))
            | table
                _time
                id
                sandfly
                active
                exclude_sandfly
                rule_op
                host_scope
                hosts_covered
                host_tags_list
                host_ids_list
                rules_list
                comment
            | sort sandfly id
          </query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 3: COVERAGE BREAKDOWN                                       -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>ğŸ“Š Coverage by Sandfly</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:whitelistrules
            | stats sum(hosts_covered) as hosts_covered by sandfly
            | sort - hosts_covered
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">none</option>
      </chart>
    </panel>

    <panel>
      <title>âš™ï¸ Rule Status Breakdown</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:whitelistrules
            | eval status=if(active=true,"âœ… Active","â›” Inactive")
            | stats count by status
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

</dashboard>
