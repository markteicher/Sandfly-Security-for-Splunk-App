<!--
=============================================================================
 default/data/ui/views/sandfly_threat_feeds.xml
 Sandfly Security for Splunk App
 Threat Feed Configuration, Health, and Risk Dashboard
=============================================================================

PURPOSE

This dashboard provides full visibility into Sandfly Threat Feed
configuration, operational health, and update reliability.


EXECUTIVE QUESTIONS ANSWERED

- How many threat feeds are configured and active?
- Which feeds are disabled or stale?
- When were feeds last updated?
- Are feeds failing to update?
- How frequently are feeds scheduled to refresh?

DATA SOURCE

- /v4/threatfeeds â†’ sourcetype=sandfly:threatfeeds

=============================================================================
-->

<dashboard version="1.1" theme="light">
  <label>Threat Feed Coverage & Health</label>

  <!-- =============================================================== -->
  <!-- ROW 1: EXECUTIVE METRICS                                       -->
  <!-- =============================================================== -->
  <row>

    <panel>
      <title>ğŸ§  Total Threat Feeds</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

    <panel>
      <title>ğŸŸ¢ Active Feeds</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | search active=true
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ”´ Disabled Feeds</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | search active=false
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

    <panel>
      <title>âš ï¸ Feeds With Update Errors</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | search last_update_message!=""
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

  </row>

  <!-- =============================================================== -->
  <!-- ROW 2: UPDATE HEALTH                                           -->
  <!-- =============================================================== -->
  <row>

    <panel>
      <title>â±ï¸ Feed Update Recency</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | spath path=last_update
            | eval last_update_epoch=strptime(last_update,"%Y-%m-%dT%H:%M:%S.%QZ")
            | eval age_hours=(now()-last_update_epoch)/3600
            | bucket age_hours span=24
            | stats count by age_hours
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>

    <panel>
      <title>ğŸ” Update Interval Distribution (Minutes)</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | stats count by interval_minutes
            | sort interval_minutes
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">none</option>
      </chart>
    </panel>

  </row>

  <!-- =============================================================== -->
  <!-- ROW 3: HIGH-RISK FEEDS                                         -->
  <!-- =============================================================== -->
  <row>

    <panel>
      <title>ğŸš© Feeds Requiring Attention</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | spath
            | eval last_update_epoch=strptime(last_update,"%Y-%m-%dT%H:%M:%S.%QZ")
            | eval age_days=(now()-last_update_epoch)/86400
            | eval risk=case(
                active=false, "ğŸ”´ Disabled",
                age_days&gt;7, "ğŸŸ¡ Stale",
                last_update_message!="" , "âš ï¸ Update Error"
              )
            | where risk!=""
            | table name risk active interval_minutes last_update last_update_message url
            | sort risk
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>

  </row>

  <!-- =============================================================== -->
  <!-- ROW 4: FULL CONFIGURATION DETAIL                               -->
  <!-- =============================================================== -->
  <row>

    <panel>
      <title>ğŸ“‹ Threat Feed Configuration Detail</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | table
                name
                description
                active
                state
                interval_minutes
                last_update
                last_update_message
                url
                lookup_url_template
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>

  </row>

</dashboard>
