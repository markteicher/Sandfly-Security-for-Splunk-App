<!--
=============================================================================
 default/data/ui/views/sandfly_executive_threatfeeds.xml
 Sandfly Security for Splunk App
 Executive Threat Feed Risk & Coverage Overview
=============================================================================

PURPOSE

Executive-level overview of Sandfly Threat Feed coverage, freshness,
and operational risk.

This view distills threat feed configuration into clear, business-facing
signals suitable for leadership, audit, and risk review.

This dashboard focuses on:
- Coverage (are feeds enabled?)
- Freshness (are feeds updating?)
- Risk (stale, disabled, or failing feeds)
- Trend indicators over time

=============================================================================
-->

<dashboard version="1.1" theme="light">
  <label>Executive Threat Feed Overview</label>

  <!-- =============================================================== -->
  <!-- ROW 1: EXECUTIVE SUMMARY METRICS                               -->
  <!-- =============================================================== -->
  <row>

    <panel>
      <title>ğŸ§  Total Threat Feeds</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

    <panel>
      <title>ğŸŸ¢ Enabled Feeds</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | search active=true
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ”´ Disabled Feeds</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | search active=false
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

    <panel>
      <title>âš ï¸ Feeds At Risk</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | spath
            | eval last_update_epoch=strptime(last_update,"%Y-%m-%dT%H:%M:%S.%QZ")
            | eval age_days=(now()-last_update_epoch)/86400
            | where active=false OR age_days&gt;7 OR last_update_message!=""
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

  </row>

  <!-- =============================================================== -->
  <!-- ROW 2: FRESHNESS & STALENESS                                   -->
  <!-- =============================================================== -->
  <row>

    <panel>
      <title>â±ï¸ Feed Freshness Distribution</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | spath
            | eval last_update_epoch=strptime(last_update,"%Y-%m-%dT%H:%M:%S.%QZ")
            | eval age_bucket=case(
                (now()-last_update_epoch)&lt;86400, "â‰¤ 24h",
                (now()-last_update_epoch)&lt;259200, "1â€“3 days",
                (now()-last_update_epoch)&lt;604800, "3â€“7 days",
                true(), "&gt; 7 days"
              )
            | stats count by age_bucket
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>

    <panel>
      <title>ğŸ” Update Frequency Profile</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | stats count by interval_minutes
            | sort interval_minutes
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.legend.placement">none</option>
      </chart>
    </panel>

  </row>

  <!-- =============================================================== -->
  <!-- ROW 3: EXECUTIVE RISK TABLE                                    -->
  <!-- =============================================================== -->
  <row>

    <panel>
      <title>ğŸš© Threat Feed Risk Register</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:threatfeeds
            | spath
            | eval last_update_epoch=strptime(last_update,"%Y-%m-%dT%H:%M:%S.%QZ")
            | eval age_days=(now()-last_update_epoch)/86400
            | eval risk=case(
                active=false, "ğŸ”´ Disabled",
                last_update_message!="" , "âš ï¸ Update Failure",
                age_days&gt;7, "ğŸŸ¡ Stale",
                true(), "ğŸŸ¢ Healthy"
              )
            | where risk!="ğŸŸ¢ Healthy"
            | table
                name
                risk
                active
                interval_minutes
                last_update
                last_update_message
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>

  </row>

</dashboard>
