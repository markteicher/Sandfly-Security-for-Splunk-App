<!--
=============================================================================
 default/data/ui/views/setup.xml
 Sandfly Security for Splunk App
 Setup Wizard
=============================================================================

SETUP WIZARD

Configures the Sandfly Security for Splunk App.

Authentication and authorization are validated during setup execution.
The provided account MUST be either:
- an admin user, OR
- an API-enabled account with required api_* roles

Setup fails with explicit validation errors if requirements are not met.

All HTML is Classic XMLâ€“safe and fully CDATA-wrapped.
=============================================================================
-->

<form version="1.1" type="wizard">
  <label>ğŸª± Sandfly Security â€“ Setup</label>

  <description>
    Configure connectivity, storage, logging, proxy settings, and data
    collection for the Sandfly Security for Splunk App.
  </description>

  <!-- =============================================================== -->
  <!-- STEP 1: SANDFLY SERVER CONNECTION                               -->
  <!-- =============================================================== -->
  <fieldset>
    <legend>ğŸ”— Sandfly Server Connection</legend>

    <input type="text" token="sandfly_url">
      <label>Sandfly Server URL</label>
      <help>Example: https://sandfly.example.com</help>
      <validation>
        <regex>^(?i)https?://.+</regex>
        <message>URL must begin with http:// or https://</message>
      </validation>
    </input>

    <!-- FIXED TOKEN -->
    <input type="text" token="username">
      <label>Username</label>
    </input>

    <!-- FIXED TOKEN -->
    <input type="password" token="password">
      <label>Password</label>
    </input>

    <html>
      <![CDATA[
      <p>
        <strong>Required permissions:</strong>
      </p>
      <ul>
        <li>Admin user <b>OR</b></li>
        <li>API-enabled account with required <code>api_*</code> roles</li>
      </ul>
      <p>
        Authentication, role validation, and API reachability are verified
        during setup. Setup will fail with a clear error if permissions
        are insufficient.
      </p>
      ]]>
    </html>
  </fieldset>

  <!-- =============================================================== -->
  <!-- STEP 2: SPLUNK INDEX CONFIGURATION                               -->
  <!-- =============================================================== -->
  <fieldset>
    <legend>ğŸ“¦ Splunk Index</legend>

    <input type="text" token="target_index">
      <label>Target Index</label>
      <help>
        The index will be created automatically if it does not exist.
      </help>
      <validation>
        <regex>^[a-zA-Z0-9_\-]+$</regex>
        <message>
          Index name may contain letters, numbers, underscores, or hyphens only.
        </message>
      </validation>
    </input>
  </fieldset>

  <!-- =============================================================== -->
  <!-- STEP 3: OPERATIONAL LOGGING                                     -->
  <!-- =============================================================== -->
  <fieldset>
    <legend>ğŸ“œ Operational Logging</legend>

    <input type="dropdown" token="enable_logging">
      <label>Enable Operational Logging</label>
      <choice value="true">Enabled</choice>
      <choice value="false">Disabled</choice>
      <default>true</default>
    </input>

    <html>
      <![CDATA[
      <p>
        When enabled, the app logs operational messages to Splunk internal logs
        using supported log levels (<code>INFO</code>, <code>WARN</code>,
        <code>ERROR</code>, <code>DEBUG</code>).
      </p>
      ]]>
    </html>
  </fieldset>

  <!-- =============================================================== -->
  <!-- STEP 4: PROXY CONFIGURATION                                     -->
  <!-- =============================================================== -->
  <fieldset>
    <legend>ğŸŒ Proxy Configuration (Optional)</legend>

    <input type="dropdown" token="proxy_mode">
      <label>Proxy Mode</label>
      <choice value="none">No Proxy</choice>
      <choice value="proxy">Proxy (No Authentication)</choice>
      <choice value="proxy_auth">Proxy (With Authentication)</choice>
      <default>none</default>
    </input>

    <input type="text" token="proxy_url" depends="$proxy_mode!=none$">
      <label>Proxy URL</label>
      <help>Example: http://proxy.example.com:8080</help>
    </input>

    <input type="text" token="proxy_user" depends="$proxy_mode=proxy_auth$">
      <label>Proxy Username</label>
    </input>

    <input type="password" token="proxy_pass" depends="$proxy_mode=proxy_auth$">
      <label>Proxy Password</label>
    </input>

    <html>
      <![CDATA[
      <p>
        Proxy connectivity is validated during setup. If a proxy is configured,
        the Sandfly API login and version checks are performed through the proxy.
      </p>
      ]]>
    </html>
  </fieldset>

  <!-- =============================================================== -->
  <!-- STEP 5: DATA COLLECTION SELECTION                               -->
  <!-- =============================================================== -->
  <fieldset>
    <legend>ğŸ“Š Data Collection</legend>

    <input type="checkbox" token="collectors">
      <label>Select Data to Collect</label>

      <choice value="hosts">Hosts</choice>
      <choice value="hosts_info">Host Details</choice>
      <choice value="users">Users</choice>
      <choice value="credentials">Credentials</choice>
      <choice value="jumphosts">Jump Hosts</choice>

      <choice value="results">Results Stream</choice>
      <choice value="results_timeline">Results Timeline</choice>
      <choice value="results_summary">Results Summary</choice>
      <choice value="resultprofiles">Drift Detection Profiles</choice>

      <choice value="sandflies">Sandflies</choice>

      <choice value="sshhunter_summary">SSH Hunter Summary</choice>
      <choice value="sshhunter_keys">SSH Hunter Keys</choice>
      <choice value="sshhunter_users">SSH Hunter Users</choice>
      <choice value="sshhunter_hosts">SSH Hunter Hosts</choice>

      <choice value="scan">Scanning</choice>
      <choice value="schedule">Schedules</choice>
      <choice value="alerts_email">Email Alerts</choice>
      <choice value="alerts_syslog">Syslog Alerts</choice>
      <choice value="notifications">Notifications</choice>
      <choice value="audit">Audit Logs</choice>
      <choice value="reports">Reports</choice>

      <default>hosts</default>
      <default>users</default>
      <default>results</default>
      <default>audit</default>
    </input>
  </fieldset>

  <!-- =============================================================== -->
  <!-- STEP 6: COMPLETE SETUP                                          -->
  <!-- =============================================================== -->
  <fieldset>
    <legend>âœ… Complete Setup</legend>

    <html>
      <![CDATA[
      <p>
        Click <b>Finish</b> to authenticate, validate permissions,
        test proxy connectivity (if configured), create required resources,
        and finalize setup.
      </p>
      <p>
        Setup completes only on success. All validation failures return
        explicit error messages.
      </p>
      ]]>
    </html>
  </fieldset>

  <submit>
    <label>ğŸš€ Finish Setup</label>
  </submit>
</form>
