<!--
=============================================================================
 default/data/ui/views/sandfly_users.xml
 Sandfly Security for Splunk App
 Users Overview
=============================================================================

PURPOSE

Displays Sandfly user accounts ingested into Splunk, including:
- Username and full name
- Email address
- Roles assigned
- Last login time and IP
- Account status indicators

Data source:
- /v4/auth, /v4/users (as ingested by sandfly_input.py)
- sourcetype: sandfly:users

=============================================================================
-->

<dashboard version="1.1" theme="light">
  <label>Users</label>

  <!-- =============================================================== -->
  <!-- ROW 1: USER COUNTS                                              -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>Total Users</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | stats count
          </query>
        </search>
        <option name="useColors">true</option>
        <option name="colorMode">block</option>
      </single>
    </panel>

    <panel>
      <title>Users by Role</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | mvexpand roles
            | stats count by roles
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 2: USER DIRECTORY                                           -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>Sandfly User Accounts</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | eval roles=mvjoin(roles, ", ")
            | table
                username
                full_name
                email
                roles
                last_login_date
                last_login_ip
                sso
            | sort username
          </query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 3: RECENT LOGIN ACTIVITY                                    -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>Recent User Login Activity</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | where isnotnull(last_login_date)
            | table
                last_login_date
                username
                email
                last_login_ip
            | sort - last_login_date
            | head 20
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

</dashboard>
