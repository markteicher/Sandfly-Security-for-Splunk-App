<!--
=============================================================================
 default/data/ui/views/sandfly_users.xml
 Sandfly Security for Splunk App
 Users
=============================================================================

PURPOSE

Inventory view of all Sandfly users retrieved from the /v4/users API endpoint
and ingested into Splunk as sourcetype=sandfly:users.

This view answers:

- Who has access to Sandfly?
- What roles are assigned?
- Are users authenticating via SSO?
- When were accounts created?
- Are there repeated failed login attempts?

All fields displayed are sourced directly from the Sandfly API response.
No inferred risk scoring or enrichment is applied.

=============================================================================
-->

<dashboard version="1.1" theme="light">
  <label>ğŸ‘¥ Users</label>

  <!-- =============================================================== -->
  <!-- ROW 1: SUMMARY METRICS                                          -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>ğŸ‘¤ Total Users</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | stats dc(username) as total_users
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <title>ğŸ” SSO Users</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | search sso=true
            | stats count as sso_users
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <title>ğŸš¨ Users with Failed Logins</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | search logins_failed_count &gt; 0
            | stats count as users_with_failures
          </query>
        </search>
      </single>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 2: ROLE DISTRIBUTION                                        -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>ğŸ§© User Roles Distribution</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | mvexpand roles
            | stats count by roles
            | sort - count
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 3: USER INVENTORY                                           -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>ğŸ“‹ User Inventory</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | table
                username
                full_name
                email
                roles
                sso
                created_date
                last_login_date
                last_login_ip
                logins_failed_count
            | sort - created_date
          </query>
        </search>

        <option name="wrap">true</option>
        <option name="rowNumbers">true</option>
        <option name="count">50</option>
      </table>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 4: FAILED LOGIN DETAILS                                     -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>âš ï¸ Failed Login Details</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:users
            | search logins_failed_count &gt; 0
            | table
                username
                logins_failed_count
                logins_failed
            | sort - logins_failed_count
          </query>
        </search>

        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
      </table>
    </panel>
  </row>

</dashboard>
