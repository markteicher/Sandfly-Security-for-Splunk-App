<!--
=============================================================================
 default/data/ui/views/sandfly_email_alerts.xml
 Sandfly Security for Splunk App
 Email Alerts Configuration & Risk Overview
=============================================================================

PURPOSE

Provides visibility into Sandfly email alert configurations, including:
- Overall alert coverage
- Recipient and mail server concentration
- Misconfigurations and operational risk
- Mail authentication posture

This view is designed to be understandable by executives while remaining
actionable for operators and administrators.

=============================================================================
-->

<dashboard version="1.1" theme="light">
  <label>ğŸ“§ Email Alerts</label>

  <!-- =============================================================== -->
  <!-- ROW 1: EXECUTIVE OVERVIEW METRICS                               -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>ğŸ“§ Total Email Alerts</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:alerts:email
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ‘¥ Unique Recipients</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:alerts:email
            | mvexpand email_recipients
            | stats dc(email_recipients)
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ–¥ï¸ Mail Servers in Use</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:alerts:email
            | stats dc(mail_server)
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>

    <panel>
      <title>âš ï¸ Misconfigured Alerts</title>
      <single>
        <search>
          <query>
            index=* sourcetype=sandfly:alerts:email
            | eval misconfigured=if(isnull(email_recipients) OR email_recipients="[]" OR isnull(email_sender) OR isnull(mail_server), 1, 0)
            | stats sum(misconfigured)
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="useColors">true</option>
      </single>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 2: ALERT CONFIGURATION RISKS                                -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>âš ï¸ Alert Configuration Risks</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:alerts:email
            | eval recipients_ok=if(isnull(email_recipients) OR email_recipients="[]","âŒ","âœ…")
            | eval sender_ok=if(isnull(email_sender),"âŒ","âœ…")
            | eval port_ok=if(mail_port=587,"âœ…","âš ï¸")
            | table name recipients_ok sender_ok mail_server mail_port port_ok
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 3: RECIPIENT & SERVER CONCENTRATION                         -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>ğŸ“Š Recipient Distribution</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:alerts:email
            | mvexpand email_recipients
            | stats count by email_recipients
            | sort - count
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>

    <panel>
      <title>ğŸ“Š Mail Server Distribution</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:alerts:email
            | stats count by mail_server
            | sort - count
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 4: MAIL AUTHENTICATION POSTURE                              -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>ğŸ” Mail Authentication Posture</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:alerts:email
            | eval auth_configured=if(isnull(mail_username),"âŒ","âœ…")
            | table name mail_server mail_port auth_configured
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

</dashboard>
