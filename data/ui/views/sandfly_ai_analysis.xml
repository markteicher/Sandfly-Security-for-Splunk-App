<!--
=============================================================================
 default/data/ui/views/sandfly_ai_analysis.xml
 Sandfly Security for Splunk App
 AI Analysis
=============================================================================

Displays AI Analysis entries generated by Sandfly, sourced from:
GET /v4/llmanalysis

Sourcetype:
  sandfly:llmanalysis
=============================================================================
-->

<dashboard version="1.1" theme="light">
  <label>AI Analysis</label>

  <!-- =============================================================== -->
  <!-- ROW 1: HIGH-LEVEL STATUS                                        -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>Analysis by State</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:llmanalysis
            | stats count by state
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>

    <panel>
      <title>Analyses Over Time</title>
      <chart>
        <search>
          <query>
            index=* sourcetype=sandfly:llmanalysis
            | timechart span=1h count
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 2: ANALYSIS SUMMARY TABLE                                   -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>AI Analysis Summary</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:llmanalysis
            | table
                _time
                id
                state
                mode
                username
                brief
                created_at
                modified_at
          </query>
        </search>
        <option name="wrap">true</option>
        <option name="count">20</option>
      </table>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 3: HOST CONTEXT                                             -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>Hosts Involved</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:llmanalysis
            | mvexpand hosts
            | eval
                host_sequence_id=hosts.host_sequence_id,
                target_address=hosts.target_address,
                node_name=hosts.node_name,
                os_release_pretty_name=hosts.os_release_pretty_name
            | table
                id
                host_sequence_id
                target_address
                node_name
                os_release_pretty_name
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- =============================================================== -->
  <!-- ROW 4: RESULT CONTEXT                                           -->
  <!-- =============================================================== -->
  <row>
    <panel>
      <title>Results Referenced by AI Analysis</title>
      <table>
        <search>
          <query>
            index=* sourcetype=sandfly:llmanalysis
            | mvexpand results
            | eval
                result_id=results.result_id,
                sandfly=results.sandfly,
                status=results.status,
                sandfly_engine=results.sandfly_engine,
                sandfly_tags=mvjoin(results.sandfly_tags, ", "),
                seen_count=results.seen_count,
                superseded=results.superseded,
                first_seen=results.first_seen,
                last_seen=results.last_seen
            | table
                id
                result_id
                status
                sandfly
                sandfly_engine
                sandfly_tags
                seen_count
                superseded
                first_seen
                last_seen
          </query>
        </search>
        <option name="wrap">true</option>
        <option name="count">20</option>
      </table>
    </panel>
  </row>

</dashboard>
